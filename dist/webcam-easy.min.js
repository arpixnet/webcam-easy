class Webcam{constructor(a,b="user",c=null,d=null){this._webcamElement=a,this._webcamElement.width=this._webcamElement.width||640,this._webcamElement.height=this._webcamElement.height||this._webcamElement.width*(3/4),this._facingMode=b,this._webcamList=[],this._streamList=[],this._selectedDeviceId="",this._canvasElement=c,this._snapSoundElement=d}get facingMode(){return this._facingMode}set facingMode(a){this._facingMode=a}get webcamList(){return this._webcamList}get webcamCount(){return this._webcamList.length}get selectedDeviceId(){return this._selectedDeviceId}getVideoInputs(a){return this._webcamList=[],a.forEach(a=>{"videoinput"===a.kind&&this._webcamList.push(a)}),1==this._webcamList.length&&(this._facingMode="user"),this._webcamList}getMediaConstraints(){var a={};""==this._selectedDeviceId?a.facingMode=this._facingMode:a.deviceId={exact:this._selectedDeviceId};return{video:a,audio:!1}}selectCamera(){for(let a of this._webcamList)if("user"==this._facingMode&&(a.label.toLowerCase().includes("front")||a.label.toLowerCase().includes("frontal"))||"environment"==this._facingMode&&a.label.toLowerCase().includes("back")||a.label.toLowerCase().includes("trasera")){this._selectedDeviceId=a.deviceId;break}}flip(){this._facingMode="user"==this._facingMode?"environment":"user",this._webcamElement.style.transform="",this.selectCamera()}async start(a=!0){return new Promise((b,c)=>{this.stop(),navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then(d=>{this._streamList.push(d),this.info().then(()=>{this.selectCamera(),a?this.stream().then(()=>{b(this._facingMode)}).catch(a=>{c(a)}):b(this._selectedDeviceId)}).catch(a=>{c(a)})}).catch(a=>{c(a)})})}async info(){return new Promise((a,b)=>{navigator.mediaDevices.enumerateDevices().then(b=>{this.getVideoInputs(b),a(this._webcamList)}).catch(a=>{b(a)})})}async stream(){return new Promise((a,b)=>{navigator.mediaDevices.getUserMedia(this.getMediaConstraints()).then(b=>{this._streamList.push(b),this._webcamElement.srcObject=b,"user"==this._facingMode&&(this._webcamElement.style.transform="scale(-1,1)"),this._webcamElement.play(),a(this._facingMode)}).catch(a=>{console.log(a),b(a)})})}stop(){this._streamList.forEach(a=>{a.getTracks().forEach(a=>{a.stop()})})}snap(){if(null!=this._canvasElement){null!=this._snapSoundElement&&this._snapSoundElement.play(),this._canvasElement.height=this._webcamElement.scrollHeight,this._canvasElement.width=this._webcamElement.scrollWidth;let a=this._canvasElement.getContext("2d");"user"==this._facingMode&&(a.translate(this._canvasElement.width,0),a.scale(-1,1)),a.clearRect(0,0,this._canvasElement.width,this._canvasElement.height),a.drawImage(this._webcamElement,0,0,this._canvasElement.width,this._canvasElement.height);let b=this._canvasElement.toDataURL("image/png");return b}throw"canvas element is missing"}}